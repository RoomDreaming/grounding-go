build:
  gpu: true
  cuda: "12.1"
  python_version: "3.11"
  system_packages:
    - "libgl1-mesa-glx"
    - "libglib2.0-0"
  python_packages:
    - "torch==2.1.2"
    - "torchvision==0.16.2"
    - "transformers==4.45.0"  # Upgraded from 4.39.0 to support Grounding DINO
    - "accelerate==0.28.0"
    - "pillow"
    - "numpy<2"               # Pinned to <2 to fix torch 2.1 compatibility
    - "opencv-python"
    - "scipy"
    - "safetensors"
  
  run:
    - "python3 -m pip install --upgrade pip"
    # (Keep the rest of your run commands the same)
    - "curl -o /tmp/download_weights.py https://raw.githubusercontent.com/RoomDreaming/grounding-go/main/download_weights.py || true"
    - "python3 -c \"import torch; from transformers import AutoProcessor, AutoModelForZeroShotObjectDetection, AutoModelForMaskGeneration; AutoProcessor.from_pretrained('IDEA-Research/grounding-dino-base'); AutoModelForZeroShotObjectDetection.from_pretrained('IDEA-Research/grounding-dino-base'); AutoProcessor.from_pretrained('facebook/sam-vit-base'); AutoModelForMaskGeneration.from_pretrained('facebook/sam-vit-base'); print('Weights downloaded successfully!')\""

predict: "predict.py:Predictor"
